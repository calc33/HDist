$namespace="HCopy"

$exename = "hcopy.exe"
$srcfile = "MainModule.Precopy.cs"
$class = "MainModule"
$varname = "PreCopyFiles"
$bindir = "bin\\Debug\\net9.0"


pushd $bindir
$indent = "`t`t`t"
$files = $indent + """" + $exename + """"
Get-ChildItem -Recurse -File | foreach {
  $f =  Resolve-Path  -Relative $_.FullName
  $f = $f -replace '^\.\\', ''
  $f = $f -replace '\\', '" + Path.DirectorySeparatorChar + "'
  if ($f -ne $exename) {
	$files += ",`r`n" + $indent + """" + $f + """"
  }
}
popd

$src = @"
// This file is generated by "UpdatePreCopy.ps1".
// $varname is listed all files in $bindir
using System.IO;

namespace $namespace
{
	partial class $class
	{
		public static readonly string[] $varname = new string[]
		{
			// first item must be ".exe"
$files
		};
	}
}
"@
echo $src | Out-File -FilePath $srcfile
